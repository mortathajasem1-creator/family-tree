<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.1, maximum-scale=4.0, user-scalable=yes">
    <title>Ø´Ø¬Ø±Ø© Ø¢Ù„ Ø¹Ú¯Ù„Ù‡ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø­Ø±Ø©</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙØ­Ø© Ù„ØªØµØ¨Ø­ Ù„ÙˆØ­Ø© ÙƒØ¨ÙŠØ±Ø© */
        body { 
            font-family: 'Amiri', serif; 
            background-color: #fdf5e6; 
            margin: 0; padding: 50px; 
            /* Ù†Ø³Ù…Ø­ Ù„Ù„ØµÙØ­Ø© Ø¨Ø£Ù† ØªØ£Ø®Ø° Ø­Ø¬Ù… Ø§Ù„Ø´Ø¬Ø±Ø© Ù…Ù‡Ù…Ø§ ÙƒØ¨Ø±Øª */
            width: max-content; 
            min-width: 100vw;
            height: max-content;
            overflow: auto; /* ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ */
        }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø´Ø¬Ø±Ø© */
        .tree { display: block; margin: auto; }
        .tree ul {
            padding-top: 20px; position: relative;
            display: flex; justify-content: center;
        }
        .tree li {
            float: right; text-align: center; list-style-type: none;
            position: relative; padding: 20px 5px 0 5px;
        }

        /* Ø§Ù„Ø®Ø·ÙˆØ· ÙˆØ§Ù„Ø£ØºØµØ§Ù† */
        .tree li::before, .tree li::after {
            content: ''; position: absolute; top: 0; right: 50%;
            border-top: 2px solid #8d6e63; width: 50%; height: 20px;
        }
        .tree li::after { right: auto; left: 50%; border-left: 2px solid #8d6e63; }
        .tree li:only-child::after, .tree li:only-child::before { display: none; }
        .tree li:only-child { padding-top: 0; }
        .tree li:first-child::before, .tree li:last-child::after { border: 0 none; }
        .tree li:last-child::before { border-right: 2px solid #8d6e63; border-radius: 0 5px 0 0; }
        .tree li:first-child::after { border-radius: 5px 0 0 0; }
        .tree ul ul::before {
            content: ''; position: absolute; top: 0; right: 50%;
            border-left: 2px solid #8d6e63; width: 0; height: 20px;
        }

        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª (Ø§Ù„Ø£Ø³Ù…Ø§Ø¡) */
        .node-content {
            background: linear-gradient(to bottom, #fff, #f1f8e9);
            border: 1px solid #558b2f;
            padding: 8px 12px;
            text-decoration: none;
            color: #33691e;
            font-size: 16px; font-weight: bold;
            display: inline-block;
            border-radius: 10px;
            box-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            min-width: 90px;
            cursor: pointer;
            white-space: nowrap; /* Ù…Ù†Ø¹ Ø§Ù„Ù†Øµ Ù…Ù† Ø§Ù„Ù†Ø²ÙˆÙ„ Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯ */
            position: relative; z-index: 2;
        }
        .root-node { background: #5d4037 !important; color: #fff !important; font-size: 20px; }
        .small-text { font-size: 12px; color: #666; display: block; margin-top: 2px; }

        /* Ø²Ø± Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ø¹Ø§Ø¦Ù… */
        #save-btn {
            position: fixed; bottom: 20px; right: 20px;
            background: #2e7d32; color: white; border: none;
            padding: 15px 25px; border-radius: 50px;
            font-size: 16px; font-family: 'Amiri';
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            cursor: pointer; z-index: 1000;
        }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ */
        #modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 2000;
            justify-content: center; align-items: center;
            backdrop-filter: blur(2px);
        }
        .modal-content {
            background: white; padding: 25px; border-radius: 15px; text-align: center; width: 85%; max-width: 300px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .modal-btn {
            display: block; width: 100%; padding: 12px; margin: 8px 0;
            border: none; border-radius: 8px; color: white; cursor: pointer; font-family: 'Amiri'; font-size: 16px;
        }
    </style>
</head>
<body>

    <div class="tree" id="familyTree">
        <ul>
            <li>
                <div class="node-content root-node" onclick="openMenu(this)">ØµÙƒØ± Ø¨Ù† Ø¹Ú¯Ù„Ù‡</div>
                <ul>
                    <li>
                        <div class="node-content" onclick="openMenu(this)">Ú†Ø§Ø³Ø¨ <br><small>1930</small></div>
                        <ul>
                            <li><div class="node-content" onclick="openMenu(this)">Ø­Ø³Ø¨ 65</div></li>
                            <li><div class="node-content" onclick="openMenu(this)">Ø¹Ø¨Ø¯ 74</div></li>
                            <li><div class="node-content" onclick="openMenu(this)">ÙØ§Ø®Ø± 71</div></li>
                            <li><div class="node-content" onclick="openMenu(this)">ÙØ§Ø¶Ù„ 73</div></li>
                            <li><div class="node-content" onclick="openMenu(this)">Ù†Ø¹ÙŠÙ… 80</div></li>
                        </ul>
                    </li>
                    
                     <li>
                        <div class="node-content" onclick="openMenu(this)">Ø­Ø§ØªÙ… <br><small>1947</small></div>
                        <ul>
                             <li><div class="node-content" onclick="openMenu(this)">Ø³Ø¹Ø¯ 74</div></li>
                             <li><div class="node-content" onclick="openMenu(this)">Ù…Ù‡Ø¯ÙŠ 87</div></li>
                             <li><div class="node-content" onclick="openMenu(this)">Ø­Ø³ÙŠÙ† 89</div></li>
                        </ul>
                    </li>

                     <li><div class="node-content" onclick="openMenu(this)">Ù‡Ø§Ø´Ù… 47</div></li>
                     <li><div class="node-content" onclick="openMenu(this)">Ù‚Ø§Ø³Ù… 51</div></li>
                     <li><div class="node-content" onclick="openMenu(this)">Ø¬Ø§Ø³Ù… 54</div></li>
                     <li><div class="node-content" onclick="openMenu(this)">ÙƒØ±ÙŠÙ… 60</div></li>
                     <li><div class="node-content" onclick="openMenu(this)">Ø­Ø³ÙŠÙ† 67</div></li>
                     <li><div class="node-content" onclick="openMenu(this)">Ø¨Ø§Ø³Ù… 70</div></li>
                     <li><div class="node-content" onclick="openMenu(this)">ÙØ§Ù„Ø­ 71</div></li>
                </ul>
            </li>
        </ul>
    </div>

    <button id="save-btn" onclick="exportHTML()">ğŸ’¾ Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯</button>

    <div id="modal">
        <div class="modal-content">
            <h3 style="margin-top:0">ØªØ¹Ø¯ÙŠÙ„: <span id="selectedName" style="color:#2e7d32"></span></h3>
            <button class="modal-btn" style="background:#1976d2" onclick="editName()">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…</button>
            <button class="modal-btn" style="background:#388e3c" onclick="addChild()">â• Ø¥Ø¶Ø§ÙØ© Ø§Ø¨Ù†</button>
            <button class="modal-btn" style="background:#d32f2f" onclick="deleteNode()">ğŸ—‘ï¸ Ø­Ø°Ù</button>
            <button class="modal-btn" style="background:#757575" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <script>
        let currentElement = null;
        const modal = document.getElementById('modal');

        // ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        function openMenu(element) {
            currentElement = element;
            // Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø³Ù… Ø¨Ø¯ÙˆÙ† Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ HTML
            let cleanName = element.innerHTML.replace(/<br>/g, " ").replace(/<small>.*?<\/small>/g, "").replace(/<span.*?<\/span>/g, "");
            document.getElementById('selectedName').innerText = cleanName;
            modal.style.display = 'flex';
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        function closeModal() { modal.style.display = 'none'; }

        // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…
        function editName() {
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ø¹Ø±Ø¶Ù‡ ÙÙŠ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù†Øµ
            let oldHTML = currentElement.innerHTML;
            let cleanText = currentElement.innerText.replace(/\n/g, " ");
            
            let newName = prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ (ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… <br> Ù„Ù„Ù†Ø²ÙˆÙ„ Ø³Ø·Ø±):", cleanText);
            if (newName) {
                // Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„ØµØºÙŠØ± Ø¥Ø°Ø§ Ù„Ù… ÙŠØºÙŠØ±Ù‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
                currentElement.innerHTML = newName;
            }
            closeModal();
        }

        // Ø¥Ø¶Ø§ÙØ© Ø§Ø¨Ù† Ø¬Ø¯ÙŠØ¯
        function addChild() {
            let childName = prompt("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø§Ø¨Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯:");
            if (childName) {
                let parentLi = currentElement.parentElement;
                let ul = parentLi.querySelector('ul');
                
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù„Ø¯ÙŠÙ‡ Ø£Ø¨Ù†Ø§Ø¡ Ø³Ø§Ø¨Ù‚Ø§Ù‹ØŒ Ù†Ù†Ø´Ø¦ Ù‚Ø§Ø¦Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©
                if (!ul) {
                    ul = document.createElement('ul');
                    parentLi.appendChild(ul);
                }
                
                let li = document.createElement('li');
                li.innerHTML = `<div class="node-content" onclick="openMenu(this)">${childName}</div>`;
                ul.appendChild(li);
            }
            closeModal();
        }

        // Ø§Ù„Ø­Ø°Ù
        function deleteNode() {
            if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù…ØŸ")) {
                let li = currentElement.parentElement;
                if(li.parentElement.children.length === 1 && li.parentElement.id !== 'familyTree') {
                    li.parentElement.remove(); // Ø­Ø°Ù Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¥Ø°Ø§ ÙØ±ØºØª
                } else {
                    li.remove();
                }
            }
            closeModal();
        }

        // Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ Ù„Ù„Ø­ÙØ¸
        function exportHTML() {
            let htmlContent = document.documentElement.outerHTML;
            navigator.clipboard.writeText(htmlContent).then(() => {
                alert("âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯!\n\nØ§Ø°Ù‡Ø¨ Ø§Ù„Ø¢Ù† Ø¥Ù„Ù‰ GitHub:\n1. Ø§Ù…Ø³Ø­ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¯ÙŠÙ…\n2. Ø§Ù„ØµÙ‚ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯\n3. Ø§Ø¶ØºØ· Commit");
            }).catch(err => {
                alert("âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ù†Ø³Ø® ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹. ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„ ÙˆÙ†Ø³Ø®Ù‡ ÙŠØ¯ÙˆÙŠØ§Ù‹.");
            });
        }
    </script>
</body>
</html>
