<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø´Ø¬Ø±Ø© Ø¢Ù„ Ø¹Ú¯Ù„Ù‡ - Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙØ­Ø© */
        body { 
            font-family: 'Amiri', serif; 
            background-color: #fdf5e6; 
            margin: 0; padding: 0; 
            overflow: hidden; /* Ù…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ÙŠ */
            height: 100vh; width: 100vw;
            touch-action: none; /* ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù„Ù…Ø³ Ø§Ù„Ù…Ø®ØµØµ */
        }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø´Ø¬Ø±Ø© Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ­Ø±ÙŠÙƒ */
        #viewport {
            width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
            cursor: grab;
        }
        
        .tree-container {
            transform-origin: center top;
            transition: transform 0.1s ease-out;
        }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø´Ø¬Ø±Ø© */
        .tree { display: flex; justify-content: center; }
        .tree ul {
            padding-top: 20px; position: relative;
            display: flex; justify-content: center;
        }
        .tree li {
            float: right; text-align: center; list-style-type: none;
            position: relative; padding: 20px 5px 0 5px;
        }

        /* Ø§Ù„Ø®Ø·ÙˆØ· ÙˆØ§Ù„Ø£ØºØµØ§Ù† */
        .tree li::before, .tree li::after {
            content: ''; position: absolute; top: 0; right: 50%;
            border-top: 2px solid #8d6e63; width: 50%; height: 20px;
        }
        .tree li::after { right: auto; left: 50%; border-left: 2px solid #8d6e63; }
        .tree li:only-child::after, .tree li:only-child::before { display: none; }
        .tree li:only-child { padding-top: 0; }
        .tree li:first-child::before, .tree li:last-child::after { border: 0 none; }
        .tree li:last-child::before { border-right: 2px solid #8d6e63; border-radius: 0 5px 0 0; }
        .tree li:first-child::after { border-radius: 5px 0 0 0; }
        .tree ul ul::before {
            content: ''; position: absolute; top: 0; right: 50%;
            border-left: 2px solid #8d6e63; width: 0; height: 20px;
        }

        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª (Ø§Ù„Ø£Ø³Ù…Ø§Ø¡) */
        .node-content {
            background: linear-gradient(to bottom, #fff, #f1f8e9);
            border: 1px solid #558b2f;
            padding: 8px 12px;
            text-decoration: none;
            color: #33691e;
            font-size: 14px; font-weight: bold;
            display: inline-block;
            border-radius: 10px;
            box-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            min-width: 80px;
            cursor: pointer;
            user-select: none;
        }
        .root-node { background: #5d4037 !important; color: #fff !important; font-size: 18px; }
        .small-text { font-size: 11px; color: #666; display: block; margin-top: 2px; }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø³ÙÙ„ÙŠØ© */
        #controls {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 20px; border-radius: 30px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            display: flex; gap: 15px; z-index: 1000;
        }
        .btn {
            background: #5d4037; color: white; border: none;
            width: 40px; height: 40px; border-radius: 50%;
            font-size: 20px; cursor: pointer;
        }
        .btn-save {
            background: #2e7d32; width: auto; padding: 0 20px;
            font-size: 14px; font-family: 'Amiri'; border-radius: 20px;
        }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ */
        #modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 2000;
            justify-content: center; align-items: center;
        }
        .modal-content {
            background: white; padding: 20px; border-radius: 10px; text-align: center; width: 80%;
        }
        .modal-btn {
            display: block; width: 100%; padding: 10px; margin: 5px 0;
            border: none; border-radius: 5px; color: white; cursor: pointer; font-family: 'Amiri';
        }
    </style>
</head>
<body>

    <div id="viewport">
        <div class="tree-container" id="treeContainer">
            <div class="tree" id="familyTree">
                <ul>
                    <li>
                        <div class="node-content root-node" onclick="openMenu(this)">ØµÙƒØ± Ø¨Ù† Ø¹Ú¯Ù„Ù‡</div>
                        <ul>
                            <li>
                                <div class="node-content" onclick="openMenu(this)">Ú†Ø§Ø³Ø¨ <br><small>1930</small></div>
                                <ul>
                                    <li><div class="node-content" onclick="openMenu(this)">Ø­Ø³Ø¨ 65</div></li>
                                    <li><div class="node-content" onclick="openMenu(this)">Ø¹Ø¨Ø¯ 74</div></li>
                                    <li><div class="node-content" onclick="openMenu(this)">ÙØ§Ø®Ø± 71</div></li>
                                    <li><div class="node-content" onclick="openMenu(this)">ÙØ§Ø¶Ù„ 73</div></li>
                                    <li><div class="node-content" onclick="openMenu(this)">Ù†Ø¹ÙŠÙ… 80</div></li>
                                </ul>
                            </li>
                            
                             <li>
                                <div class="node-content" onclick="openMenu(this)">Ø­Ø§ØªÙ… <br><small>1947</small></div>
                                <ul>
                                     <li><div class="node-content" onclick="openMenu(this)">Ø³Ø¹Ø¯ 74</div></li>
                                     <li><div class="node-content" onclick="openMenu(this)">Ù…Ù‡Ø¯ÙŠ 87</div></li>
                                     <li><div class="node-content" onclick="openMenu(this)">Ø­Ø³ÙŠÙ† 89</div></li>
                                </ul>
                            </li>

                            <li><div class="node-content" onclick="openMenu(this)">Ù‡Ø§Ø´Ù… 47</div></li>
                             <li><div class="node-content" onclick="openMenu(this)">Ù‚Ø§Ø³Ù… 51</div></li>
                             <li><div class="node-content" onclick="openMenu(this)">Ø¬Ø§Ø³Ù… 54</div></li>
                             <li><div class="node-content" onclick="openMenu(this)">ÙƒØ±ÙŠÙ… 60</div></li>
                             <li><div class="node-content" onclick="openMenu(this)">Ø­Ø³ÙŠÙ† 67</div></li>
                             <li><div class="node-content" onclick="openMenu(this)">Ø¨Ø§Ø³Ù… 70</div></li>
                             <li><div class="node-content" onclick="openMenu(this)">ÙØ§Ù„Ø­ 71</div></li>

                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div id="controls">
        <button class="btn" onclick="zoom(0.1)">+</button>
        <button class="btn" onclick="zoom(-0.1)">-</button>
        <button class="btn btn-save" onclick="exportHTML()">ğŸ’¾ Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯</button>
    </div>

    <div id="modal">
        <div class="modal-content">
            <h3>ØªØ¹Ø¯ÙŠÙ„: <span id="selectedName"></span></h3>
            <button class="modal-btn" style="background:#1976d2" onclick="editName()">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…</button>
            <button class="modal-btn" style="background:#388e3c" onclick="addChild()">â• Ø¥Ø¶Ø§ÙØ© Ø§Ø¨Ù†</button>
            <button class="modal-btn" style="background:#d32f2f" onclick="deleteNode()">ğŸ—‘ï¸ Ø­Ø°Ù</button>
            <button class="modal-btn" style="background:#757575" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <script>
        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø­Ø±ÙƒØ©
        let scale = 1;
        let pannedX = 0;
        let pannedY = 0;
        const container = document.getElementById('treeContainer');
        const viewport = document.getElementById('viewport');
        
        // Ù…Ù†Ø·Ù‚ Ø§Ù„Ø­Ø±ÙƒØ© (Pan & Zoom)
        let isDragging = false;
        let startX, startY;

        viewport.addEventListener('mousedown', startDrag);
        viewport.addEventListener('touchstart', startDrag);

        document.addEventListener('mousemove', drag);
        document.addEventListener('touchmove', drag);

        document.addEventListener('mouseup', endDrag);
        document.addEventListener('touchend', endDrag);

        function startDrag(e) {
            if(e.target.closest('.node-content')) return; // Ø¹Ø¯Ù… Ø§Ù„Ø³Ø­Ø¨ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ø³Ù…
            isDragging = true;
            const point = e.touches ? e.touches[0] : e;
            startX = point.clientX - pannedX;
            startY = point.clientY - pannedY;
        }

        function drag(e) {
            if (!isDragging) return;
            e.preventDefault();
            const point = e.touches ? e.touches[0] : e;
            pannedX = point.clientX - startX;
            pannedY = point.clientY - startY;
            updateTransform();
        }

        function endDrag() { isDragging = false; }

        function zoom(delta) {
            scale += delta;
            if (scale < 0.2) scale = 0.2;
            updateTransform();
        }

        function updateTransform() {
            container.style.transform = `translate(${pannedX}px, ${pannedY}px) scale(${scale})`;
        }

        // Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø¥Ø¶Ø§ÙØ©
        let currentElement = null;
        const modal = document.getElementById('modal');

        function openMenu(element) {
            currentElement = element;
            document.getElementById('selectedName').innerText = element.innerText;
            modal.style.display = 'flex';
        }

        function closeModal() { modal.style.display = 'none'; }

        function editName() {
            let newName = prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯:", currentElement.innerHTML.replace(/<br>/g, " ").replace(/<small>.*?<\/small>/g, ""));
            if (newName) currentElement.innerHTML = newName;
            closeModal();
        }

        function addChild() {
            let childName = prompt("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø§Ø¨Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯:");
            if (childName) {
                let parentLi = currentElement.parentElement;
                let ul = parentLi.querySelector('ul');
                
                if (!ul) {
                    ul = document.createElement('ul');
                    parentLi.appendChild(ul);
                }
                
                let li = document.createElement('li');
                li.innerHTML = `<div class="node-content" onclick="openMenu(this)">${childName}</div>`;
                ul.appendChild(li);
            }
            closeModal();
        }

        function deleteNode() {
            if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… ÙˆÙƒÙ„ ÙØ±ÙˆØ¹Ù‡ØŸ")) {
                let li = currentElement.parentElement;
                if(li.parentElement.children.length === 1 && li.parentElement.id !== 'familyTree') {
                    li.parentElement.remove(); // Ø­Ø°Ù Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¥Ø°Ø§ ÙØ±ØºØª
                } else {
                    li.remove();
                }
            }
            closeModal();
        }

        // Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ Ù„Ù„Ø­ÙØ¸
        function exportHTML() {
            alert("Ø³ÙŠØªÙ… Ø§Ù„Ø¢Ù† Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ ÙƒØ§Ù…Ù„Ø§Ù‹. \n\n1. Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ GitHub.\n2. Ø§Ù…Ø³Ø­ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¯ÙŠÙ….\n3. Ø§Ù„ØµÙ‚ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯.\n4. Ø§Ø¶ØºØ· Commit.");
            
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„ØµÙØ­Ø© Ù‚Ø¨Ù„ Ø§Ù„Ù†Ø³Ø® (Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø­Ø¬Ù… Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ Ù…Ø¤Ù‚ØªØ§Ù‹)
            let tempScale = scale;
            let tempX = pannedX; 
            let tempY = pannedY;
            
            // Ù†Ø³Ø® Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø©
            let htmlContent = document.documentElement.outerHTML;
            
            // Ù†Ø³Ø® Ù„Ù„Ø­Ø§ÙØ¸Ø©
            navigator.clipboard.writeText(htmlContent).then(() => {
                alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯! Ø§Ø°Ù‡Ø¨ Ù„Ù€ GitHub Ø§Ù„Ø¢Ù†.");
            }).catch(err => {
                console.error('ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®', err);
                alert("ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØŒ Ø­Ø§ÙˆÙ„ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Øµ ÙˆÙ†Ø³Ø®Ù‡ ÙŠØ¯ÙˆÙŠØ§Ù‹.");
            });
        }
    </script>
</body>
</html>
